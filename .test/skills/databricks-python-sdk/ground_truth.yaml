# Ground truth test cases for databricks-python-sdk skill
# Add test cases using: /skill-test databricks-python-sdk add
test_cases:
  - id: "sdk_clusters_list_001"
    created_at: "2026-02-04"

    inputs:
      prompt: "List all running clusters using the Python SDK and use DATABRICKS_CONFIG_PROFILE env variable. Execute the code so we know it runs in Databricks"

    outputs:
      response: |
        To list all running clusters using the Python SDK with the `DATABRICKS_CONFIG_PROFILE` environment variable:

        ```python
        import os
        from databricks.sdk import WorkspaceClient

        # Use profile from environment variable (defaults to DEFAULT if not set)
        profile = os.environ.get("DATABRICKS_CONFIG_PROFILE", "DEFAULT")
        w = WorkspaceClient(profile=profile)

        # List all clusters and filter for running ones
        print(f"Running clusters (profile: {profile}):\n")
        for cluster in w.clusters.list():
            if cluster.state.value == "RUNNING":
                print(f"  {cluster.cluster_name}")
                print(f"    ID: {cluster.cluster_id}")
                print(f"    State: {cluster.state.value}")
                print(f"    Spark Version: {cluster.spark_version}")
                print(f"    Node Type: {cluster.node_type_id}")
                print()
        ```
      execution_success: true

    expectations:
      expected_facts:
        - "Uses WorkspaceClient from databricks.sdk"
        - "Uses DATABRICKS_CONFIG_PROFILE environment variable"
        - "Filters clusters by RUNNING state"
        - "Uses w.clusters.list() for listing"

      expected_patterns:
        - pattern: "from databricks\\.sdk import WorkspaceClient"
          min_count: 1
        - pattern: "DATABRICKS_CONFIG_PROFILE"
          min_count: 1
        - pattern: "w\\.clusters\\.list\\(\\)"
          min_count: 1
        - pattern: "\\.state"
          min_count: 1

      guidelines:
        - "Must use modern SDK (databricks.sdk, not legacy)"
        - "Should read profile from environment variable"
        - "Should filter for running clusters using state property"

    metadata:
      category: "happy_path"
      difficulty: "easy"
      source: "interactive"
      tags: ["clusters", "list", "environment-variable", "filtering"]
      verified_at: "2026-02-04"
